{
  "readChangeStreamTests": [
    {
      "description": "1 heartbeat",
      "api_responses": [
        {
          "heartbeat": {
            "continuation_token": {
              "partition": {
                "row_range": {
                  "start_key_closed": "",
                  "end_key_open": ""
                }
              },
              "token": "heartbeat-token"
            },
            "low_watermark": "2022-07-01T00:00:00Z"
          }
        }
      ],
      "results": [
        {
          "record" : {
            "heartbeat": {
              "continuation_token": {
                "partition": {
                  "row_range": {
                    "start_key_closed": "",
                    "end_key_open": ""
                  }
                },
                "token": "heartbeat-token"
              },
              "low_watermark": "2022-07-01T00:00:00Z"
            }
          },
          "error": false
        }
      ]
    },
    {
      "description": "1 CloseStream",
      "api_responses": [
        {
          "close_stream": {
            "status": {
              "code": "11",
              "message": "Partition boundaries are misaligned."
            },
            "continuation_tokens": [
              {
                "partition": {
                  "row_range": {
                    "start_key_closed": "",
                    "end_key_open": "0000000000000001"
                  }
                },
                "token": "close-stream-token-1"
              },
              {
                "partition": {
                  "row_range": {
                    "start_key_closed": "0000000000000001",
                    "end_key_open": "0000000000000002"
                  }
                },
                "token": "close-stream-token-2"
              }
            ]
          }
        }
      ],
      "results": [
        {
          "record" : {
            "close_stream": {
              "status": {
                "code": "11",
                "message": "Partition boundaries are misaligned."
              },
              "continuation_tokens": [
                {
                  "partition": {
                    "row_range": {
                      "start_key_closed": "",
                      "end_key_open": "0000000000000001"
                    }
                  },
                  "token": "close-stream-token-1"
                },
                {
                  "partition": {
                    "row_range": {
                      "start_key_closed": "0000000000000001",
                      "end_key_open": "0000000000000002"
                    }
                  },
                  "token": "close-stream-token-2"
                }
              ]
            }
          },
          "error": false
        }
      ]
    },
    {
      "description": "1 heartbeat + 1 CloseStream",
      "api_responses": [
        {
          "heartbeat": {
            "continuation_token": {
              "partition": {
                "row_range": {
                  "start_key_closed": "",
                  "end_key_open": ""
                }
              },
              "token": "heartbeat-token"
            },
            "low_watermark": "2022-07-01T00:00:00Z"
          }
        },
        {
          "close_stream": {
            "status": {
              "code": "11",
              "message": "Partition boundaries are misaligned."
            },
            "continuation_tokens": [
              {
                "partition": {
                  "row_range": {
                    "start_key_closed": "",
                    "end_key_open": "0000000000000001"
                  }
                },
                "token": "close-stream-token-1"
              }
            ]
          }
        }
      ],
      "results": [
        {
          "record" : {
            "heartbeat": {
              "continuation_token": {
                "partition": {
                  "row_range": {
                    "start_key_closed": "",
                    "end_key_open": ""
                  }
                },
                "token": "heartbeat-token"
              },
              "low_watermark": "2022-07-01T00:00:00Z"
            }
          },
          "error": false
        },
        {
          "record" : {
            "close_stream": {
              "status": {
                "code": "11",
                "message": "Partition boundaries are misaligned."
              },
              "continuation_tokens": [
                {
                  "partition": {
                    "row_range": {
                      "start_key_closed": "",
                      "end_key_open": "0000000000000001"
                    }
                  },
                  "token": "close-stream-token-1"
                }
              ]
            }
          },
          "error": false
        }
      ]
    },
    {
      "description": "1 logical mutation no chunking",
      "api_responses": [
        {
          "data_change": {
            "row_key": "0000000000000000",
            "type": "USER",
            "source_cluster_id": "source-cluster-id",
            "commit_timestamp": "2022-07-01T00:00:00Z",
            "tiebreaker": 100,
            "token": "data-change-token",
            "low_watermark": "2022-07-01T00:00:00Z",
            "chunks": [
              {
                "mutation": {
                  "delete_from_family": {
                    "family_name": "family"
                  }
                }
              }
            ],
            "done": true
          }
        }
      ],
      "results": [
        {
          "record": {
            "change_stream_mutation": {
              "row_key": "0000000000000000",
              "type": "USER",
              "source_cluster_id": "source-cluster-id",
              "commit_timestamp": "2022-07-01T00:00:00Z",
              "low_watermark": "2022-07-01T00:00:00Z",
              "tiebreaker": 100,
              "token": "data-change-token",
              "mutations": [
                {
                  "delete_from_family": {
                    "family_name": "family"
                  }
                }
              ]
            }
          },
          "error": false
        }
      ]
    },
    {
      "description": "1 incomplete logical mutation",
      "api_responses": [
        {
          "data_change": {
            "row_key": "0000000000000000",
            "type": "USER",
            "source_cluster_id": "source-cluster-id",
            "commit_timestamp": "2022-07-01T00:00:00Z",
            "tiebreaker": 100,
            "token": "data-change-token",
            "chunks": [
              {
                "mutation": {
                  "delete_from_family": {
                    "family_name": "family"
                  }
                }
              }
            ]
          }
        }
      ],
      "results": [
        {
          "error": true
        }
      ]
    },
    {
      "description": "GC mutation no source cluster id",
      "api_responses": [
        {
          "data_change": {
            "row_key": "0000000000000000",
            "type": "GARBAGE_COLLECTION",
            "commit_timestamp": "2022-07-01T00:00:00Z",
            "tiebreaker": 100,
            "token": "data-change-token",
            "low_watermark": "2022-07-01T00:00:00Z",
            "chunks": [
              {
                "mutation": {
                  "delete_from_family": {
                    "family_name": "family"
                  }
                }
              }
            ],
            "done": true
          }
        }
      ],
      "results": [
        {
          "record": {
            "change_stream_mutation": {
              "row_key": "0000000000000000",
              "type": "GARBAGE_COLLECTION",
              "commit_timestamp": "2022-07-01T00:00:00Z",
              "tiebreaker": 100,
              "token": "data-change-token",
              "low_watermark": "2022-07-01T00:00:00Z",
              "mutations": [
                {
                  "delete_from_family": {
                    "family_name": "family"
                  }
                }
              ]
            }
          },
          "error": false
        }
      ]
    },
    {
      "description": "1 chunked SetCell",
      "api_responses": [
        {
          "data_change": {
            "row_key": "0000000000000000",
            "type": "USER",
            "source_cluster_id": "source-cluster-id",
            "commit_timestamp": "2022-07-01T00:00:00Z",
            "tiebreaker": 100,
            "chunks": [
              {
                "chunk_info": {
                  "chunked_value_size": 1
                },
                "mutation": {
                  "set_cell": {
                    "family_name": "family",
                    "column_qualifier": "0000000000000000",
                    "timestamp_micros": 1000,
                    "value": "dg=="
                  }
                }
              }
            ]
          }
        },
        {
          "data_change": {
            "type": "CONTINUATION",
            "token": "data-change-token",
            "low_watermark": "2022-07-01T00:00:00Z",
            "chunks": [
              {
                "chunk_info": {
                  "chunked_value_offset": 1,
                  "chunked_value_size": 1,
                  "last_chunk": true
                },
                "mutation": {
                  "set_cell": {
                    "value": ""
                  }
                }
              }
            ],
            "done": true
          }
        }
      ],
      "results": [
        {
          "record": {
            "change_stream_mutation": {
              "row_key": "0000000000000000",
              "type": "USER",
              "source_cluster_id": "source-cluster-id",
              "commit_timestamp": "2022-07-01T00:00:00Z",
              "tiebreaker": 100,
              "token": "data-change-token",
              "low_watermark": "2022-07-01T00:00:00Z",
              "mutations": [
                {
                  "set_cell": {
                    "family_name": "family",
                    "column_qualifier": "0000000000000000",
                    "timestamp_micros": 1000,
                    "value": "dg=="
                  }
                }
              ]
            }
          },
          "error": false
        }
      ]
    },
    {
      "description": "2 chunked SetCells",
      "api_responses": [
        {
          "data_change": {
            "row_key": "0000000000000000",
            "type": "USER",
            "source_cluster_id": "source-cluster-id",
            "commit_timestamp": "2022-07-01T00:00:00Z",
            "tiebreaker": 100,
            "chunks": [
              {
                "chunk_info": {
                  "chunked_value_size": 1
                },
                "mutation": {
                  "set_cell": {
                    "family_name": "family",
                    "column_qualifier": "0000000000000000",
                    "timestamp_micros": 1000,
                    "value": "dg=="
                  }
                }
              }
            ]
          }
        },
        {
          "data_change": {
            "type": "CONTINUATION",
            "chunks": [
              {
                "chunk_info": {
                  "chunked_value_offset": 1,
                  "chunked_value_size": 1,
                  "last_chunk": true
                },
                "mutation": {
                  "set_cell": {
                    "value": ""
                  }
                }
              },
              {
                "chunk_info": {
                  "chunked_value_size": 1
                },
                "mutation": {
                  "set_cell": {
                    "family_name": "family",
                    "column_qualifier": "0000000000000000",
                    "timestamp_micros": 1000,
                    "value": "dg=="
                  }
                }
              }
            ]
          }
        },
        {
          "data_change": {
            "type": "CONTINUATION",
            "token": "data-change-token",
            "low_watermark": "2022-07-01T00:00:00Z",
            "chunks": [
              {
                "chunk_info": {
                  "chunked_value_offset": 1,
                  "chunked_value_size": 1,
                  "last_chunk": true
                },
                "mutation": {
                  "set_cell": {
                    "value": ""
                  }
                }
              }
            ],
            "done": true
          }
        }
      ],
      "results": [
        {
          "record": {
            "change_stream_mutation": {
              "row_key": "0000000000000000",
              "type": "USER",
              "source_cluster_id": "source-cluster-id",
              "commit_timestamp": "2022-07-01T00:00:00Z",
              "tiebreaker": 100,
              "token": "data-change-token",
              "low_watermark": "2022-07-01T00:00:00Z",
              "mutations": [
                {
                  "set_cell": {
                    "family_name": "family",
                    "column_qualifier": "0000000000000000",
                    "timestamp_micros": 1000,
                    "value": "dg=="
                  }
                },
                {
                  "set_cell": {
                    "family_name": "family",
                    "column_qualifier": "0000000000000000",
                    "timestamp_micros": 1000,
                    "value": "dg=="
                  }
                }
              ]
            }
          },
          "error": false
        }
      ]
    },
    {
      "description": "1 chunked SetCell + 1 unchunked SetCell",
      "api_responses": [
        {
          "data_change": {
            "row_key": "0000000000000000",
            "type": "USER",
            "source_cluster_id": "source-cluster-id",
            "commit_timestamp": "2022-07-01T00:00:00Z",
            "tiebreaker": 100,
            "chunks": [
              {
                "chunk_info": {
                  "chunked_value_size": 1
                },
                "mutation": {
                  "set_cell": {
                    "family_name": "family",
                    "column_qualifier": "0000000000000000",
                    "timestamp_micros": 1000,
                    "value": "dg=="
                  }
                }
              }
            ]
          }
        },
        {
          "data_change": {
            "type": "CONTINUATION",
            "token": "data-change-token",
            "low_watermark": "2022-07-01T00:00:00Z",
            "chunks": [
              {
                "chunk_info": {
                  "chunked_value_offset": 1,
                  "chunked_value_size": 1,
                  "last_chunk": true
                },
                "mutation": {
                  "set_cell": {
                    "value": ""
                  }
                }
              },
              {
                "mutation": {
                  "set_cell": {
                    "family_name": "family",
                    "column_qualifier": "0000000000000000",
                    "timestamp_micros": 1000,
                    "value": "dg=="
                  }
                }
              }
            ],
            "done": true
          }
        }
      ],
      "results": [
        {
          "record": {
            "change_stream_mutation": {
              "row_key": "0000000000000000",
              "type": "USER",
              "source_cluster_id": "source-cluster-id",
              "commit_timestamp": "2022-07-01T00:00:00Z",
              "tiebreaker": 100,
              "token": "data-change-token",
              "low_watermark": "2022-07-01T00:00:00Z",
              "mutations": [
                {
                  "set_cell": {
                    "family_name": "family",
                    "column_qualifier": "0000000000000000",
                    "timestamp_micros": 1000,
                    "value": "dg=="
                  }
                },
                {
                  "set_cell": {
                    "family_name": "family",
                    "column_qualifier": "0000000000000000",
                    "timestamp_micros": 1000,
                    "value": "dg=="
                  }
                }
              ]
            }
          },
          "error": false
        }
      ]
    },
    {
      "description": "1 unchunked SetCell + 1 chunked SetCell",
      "api_responses": [
        {
          "data_change": {
            "row_key": "0000000000000000",
            "type": "USER",
            "source_cluster_id": "source-cluster-id",
            "commit_timestamp": "2022-07-01T00:00:00Z",
            "tiebreaker": 100,
            "chunks": [
              {
                "mutation": {
                  "set_cell": {
                    "family_name": "family",
                    "column_qualifier": "0000000000000000",
                    "timestamp_micros": 1000,
                    "value": "dg=="
                  }
                }
              },
              {
                "chunk_info": {
                  "chunked_value_size": 1
                },
                "mutation": {
                  "set_cell": {
                    "family_name": "family",
                    "column_qualifier": "0000000000000000",
                    "timestamp_micros": 1000,
                    "value": "dg=="
                  }
                }
              }
            ]
          }
        },
        {
          "data_change": {
            "type": "CONTINUATION",
            "token": "data-change-token",
            "low_watermark": "2022-07-01T00:00:00Z",
            "chunks": [
              {
                "chunk_info": {
                  "chunked_value_offset": 1,
                  "chunked_value_size": 1,
                  "last_chunk": true
                },
                "mutation": {
                  "set_cell": {
                    "value": ""
                  }
                }
              }
            ],
            "done": true
          }
        }
      ],
      "results": [
        {
          "record": {
            "change_stream_mutation": {
              "row_key": "0000000000000000",
              "type": "USER",
              "source_cluster_id": "source-cluster-id",
              "commit_timestamp": "2022-07-01T00:00:00Z",
              "tiebreaker": 100,
              "token": "data-change-token",
              "low_watermark": "2022-07-01T00:00:00Z",
              "mutations": [
                {
                  "set_cell": {
                    "family_name": "family",
                    "column_qualifier": "0000000000000000",
                    "timestamp_micros": 1000,
                    "value": "dg=="
                  }
                },
                {
                  "set_cell": {
                    "family_name": "family",
                    "column_qualifier": "0000000000000000",
                    "timestamp_micros": 1000,
                    "value": "dg=="
                  }
                }
              ]
            }
          },
          "error": false
        }
      ]
    },
    {
      "description": "1 mod + 1 chunked SetCell + 1 mod",
      "api_responses": [
        {
          "data_change": {
            "row_key": "0000000000000000",
            "type": "USER",
            "source_cluster_id": "source-cluster-id",
            "commit_timestamp": "2022-07-01T00:00:00Z",
            "tiebreaker": 100,
            "chunks": [
              {
                "mutation": {
                  "delete_from_family": {
                    "family_name": "family"
                  }
                }
              },
              {
                "chunk_info": {
                  "chunked_value_size": 1
                },
                "mutation": {
                  "set_cell": {
                    "family_name": "family",
                    "column_qualifier": "0000000000000000",
                    "timestamp_micros": 1000,
                    "value": "dg=="
                  }
                }
              }
            ]
          }
        },
        {
          "data_change": {
            "type": "CONTINUATION",
            "token": "data-change-token",
            "low_watermark": "2022-07-01T00:00:00Z",
            "chunks": [
              {
                "chunk_info": {
                  "chunked_value_offset": 1,
                  "chunked_value_size": 1,
                  "last_chunk": true
                },
                "mutation": {
                  "set_cell": {
                    "value": ""
                  }
                }
              },
              {
                "mutation": {
                  "delete_from_family": {
                    "family_name": "family"
                  }
                }
              }
            ],
            "done": true
          }
        }
      ],
      "results": [
        {
          "record": {
            "change_stream_mutation": {
              "row_key": "0000000000000000",
              "type": "USER",
              "source_cluster_id": "source-cluster-id",
              "commit_timestamp": "2022-07-01T00:00:00Z",
              "tiebreaker": 100,
              "token": "data-change-token",
              "low_watermark": "2022-07-01T00:00:00Z",
              "mutations": [
                {
                  "delete_from_family": {
                    "family_name": "family"
                  }
                },
                {
                  "set_cell": {
                    "family_name": "family",
                    "column_qualifier": "0000000000000000",
                    "timestamp_micros": 1000,
                    "value": "dg=="
                  }
                },
                {
                  "delete_from_family": {
                    "family_name": "family"
                  }
                }
              ]
            }
          },
          "error": false
        }
      ]
    },
    {
      "description": "non SetCell chunking",
      "api_responses": [
        {
          "data_change": {
            "row_key": "0000000000000000",
            "type": "USER",
            "source_cluster_id": "source-cluster-id",
            "commit_timestamp": "2022-07-01T00:00:00Z",
            "tiebreaker": 100,
            "chunks": [
              {
                "mutation": {
                  "delete_from_family": {
                    "family_name": "family"
                  }
                }
              }
            ]
          }
        },
        {
          "data_change": {
            "type": "CONTINUATION",
            "token": "data-change-token",
            "low_watermark": "2022-07-01T00:00:00Z",
            "chunks": [
              {
                "mutation": {
                  "delete_from_family": {
                    "family_name": "family"
                  }
                }
              }
            ],
            "done": true
          }
        }
      ],
      "results": [
        {
          "record": {
            "change_stream_mutation": {
              "row_key": "0000000000000000",
              "type": "USER",
              "source_cluster_id": "source-cluster-id",
              "commit_timestamp": "2022-07-01T00:00:00Z",
              "tiebreaker": 100,
              "token": "data-change-token",
              "low_watermark": "2022-07-01T00:00:00Z",
              "mutations": [
                {
                  "delete_from_family": {
                    "family_name": "family"
                  }
                },
                {
                  "delete_from_family": {
                    "family_name": "family"
                  }
                }
              ]
            }
          },
          "error": false
        }
      ]
    },
    {
      "description": "2 logical mutations with non SetCell chunking + CloseStream",
      "api_responses": [
        {
          "data_change": {
            "row_key": "0000000000000000",
            "type": "USER",
            "source_cluster_id": "source-cluster-id",
            "commit_timestamp": "2022-07-01T00:00:00Z",
            "tiebreaker": 100,
            "chunks": [
              {
                "mutation": {
                  "delete_from_family": {
                    "family_name": "family"
                  }
                }
              }
            ]
          }
        },
        {
          "data_change": {
            "type": "CONTINUATION",
            "token": "data-change-token",
            "low_watermark": "2022-07-01T00:00:00Z",
            "chunks": [
              {
                "mutation": {
                  "delete_from_family": {
                    "family_name": "family"
                  }
                }
              }
            ],
            "done": true
          }
        },
        {
          "data_change": {
            "row_key": "0000000000000000",
            "type": "USER",
            "source_cluster_id": "source-cluster-id",
            "commit_timestamp": "2022-07-01T00:00:00Z",
            "tiebreaker": 100,
            "chunks": [
              {
                "mutation": {
                  "delete_from_family": {
                    "family_name": "family"
                  }
                }
              }
            ]
          }
        },
        {
          "data_change": {
            "type": "CONTINUATION",
            "token": "data-change-token",
            "low_watermark": "2022-07-01T00:00:00Z",
            "chunks": [
              {
                "mutation": {
                  "delete_from_family": {
                    "family_name": "family"
                  }
                }
              }
            ],
            "done": true
          }
        },
        {
          "close_stream": {
            "status": {
              "code": "11",
              "message": "Partition boundaries are misaligned."
            },
            "continuation_tokens": [
              {
                "partition": {
                  "row_range": {
                    "start_key_closed": "",
                    "end_key_open": "0000000000000001"
                  }
                },
                "token": "close-stream-token-1"
              },
              {
                "partition": {
                  "row_range": {
                    "start_key_closed": "0000000000000001",
                    "end_key_open": "0000000000000002"
                  }
                },
                "token": "close-stream-token-2"
              }
            ]
          }
        }
      ],
      "results": [
        {
          "record": {
            "change_stream_mutation": {
              "row_key": "0000000000000000",
              "type": "USER",
              "source_cluster_id": "source-cluster-id",
              "commit_timestamp": "2022-07-01T00:00:00Z",
              "tiebreaker": 100,
              "token": "data-change-token",
              "low_watermark": "2022-07-01T00:00:00Z",
              "mutations": [
                {
                  "delete_from_family": {
                    "family_name": "family"
                  }
                },
                {
                  "delete_from_family": {
                    "family_name": "family"
                  }
                }
              ]
            }
          },
          "error": false
        },
        {
          "record": {
            "change_stream_mutation": {
              "row_key": "0000000000000000",
              "type": "USER",
              "source_cluster_id": "source-cluster-id",
              "commit_timestamp": "2022-07-01T00:00:00Z",
              "tiebreaker": 100,
              "token": "data-change-token",
              "low_watermark": "2022-07-01T00:00:00Z",
              "mutations": [
                {
                  "delete_from_family": {
                    "family_name": "family"
                  }
                },
                {
                  "delete_from_family": {
                    "family_name": "family"
                  }
                }
              ]
            }
          },
          "error": false
        },
        {
          "record" : {
            "close_stream": {
              "status": {
                "code": "11",
                "message": "Partition boundaries are misaligned."
              },
              "continuation_tokens": [
                {
                  "partition": {
                    "row_range": {
                      "start_key_closed": "",
                      "end_key_open": "0000000000000001"
                    }
                  },
                  "token": "close-stream-token-1"
                },
                {
                  "partition": {
                    "row_range": {
                      "start_key_closed": "0000000000000001",
                      "end_key_open": "0000000000000002"
                    }
                  },
                  "token": "close-stream-token-2"
                }
              ]
            }
          },
          "error": false
        }
      ]
    }
  ]
}